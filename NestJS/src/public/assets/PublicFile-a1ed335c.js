import{O as s,U as o}from"./UpLoad-df9f454c.js";import{n as r}from"./index-b03ec83c.js";const n={name:"Class",components:{OpenImages:s,UpLoad:o},data(){return{tableData:{},params:{pageNum:1,pageSize:10,folderId:"",filePrefix:"",folderVisible:""},dialogVisible:!1,dialogFileVisible:!1,form:{},dialogFile:{title:"",pathUrl:"",folderVisible:null},listDataFolder:{}}},async mounted(){await this.onSearch(),await this.onSearchFolder()},methods:{async onSearchFolder(){this.listDataFolder=await this.$request.get("/folder?pageNum=1&pageSize=99999")},onOpen(i){this.dialogFile.title=i.filePrefix+i.fileSuffix,this.dialogFile.pathUrl=i.filePath,this.dialogFile.folderVisible=i.folderVisible,this.dialogFileVisible=!0},async onCopy(i){navigator.clipboard.writeText(`${i}`),this.$message.success("复制成功")},async onSearch(){let{pageNum:i,pageSize:e}=this.params;this.tableData=await this.$request.get(`/file/public?pageNum=${i}&pageSize=${e}`)},onAdd(){this.form={folderId:"",file:null},this.dialogVisible=!0},onEdit(i){this.form={...i},this.dialogVisible=!0},async onSubmit(){this.form.id!=null?await this.$request.patch(`/file/${this.form.id}`,{...this.form}):await this.$request.post("/file",{...this.form}),this.dialogVisible=!1,await this.$message.success("操作成功"),await this.onSearch()},async onDelete(i){await this.$confirm(`是否确认删除${i.filePrefix+i.fileSuffix}?`),await this.$request.delete(`/file/${i.id}`),await this.$message.success("操作成功"),await this.onSearch()},handlePageChange(i){this.params.pageNum=i,this.onSearch()},handleSizeChange(i){this.params.pageSize=i,this.onSearch()},async handleClose(i){i(),await this.onSearch()}}};var c=function(){var e=this,l=e._self._c;return l("div",{staticClass:"container"},[l("el-form",{attrs:{inline:"",size:"small"}},[l("el-form-item",{attrs:{label:"文件夹"}},[l("el-select",{staticClass:"w-100",attrs:{placeholder:"文件夹",clearable:""},model:{value:e.params.folderId,callback:function(a){e.$set(e.params,"folderId",a)},expression:"params.folderId"}},e._l(e.listDataFolder.records,function(a,t){return l("el-option",{key:t,attrs:{label:a.name,value:a.id}})}),1)],1),l("el-form-item",{attrs:{label:"名称"}},[l("el-input",{attrs:{placeholder:"名称",clearable:""},model:{value:e.params.filePrefix,callback:function(a){e.$set(e.params,"filePrefix",a)},expression:"params.filePrefix"}})],1),l("el-form-item",{attrs:{label:"可见类型"}},[l("el-select",{staticClass:"w-100",attrs:{placeholder:"可见类型",clearable:""},model:{value:e.params.folderVisible,callback:function(a){e.$set(e.params,"folderVisible",a)},expression:"params.folderVisible"}},[l("el-option",{attrs:{label:"公共",value:"0"}}),l("el-option",{attrs:{label:"私密",value:"1"}})],1)],1),l("el-form-item",[l("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.onSearch}},[e._v("查询")])],1)],1),l("el-table",{staticClass:"cp",staticStyle:{width:"100%","border-radius":"10px"},attrs:{data:e.tableData.records,border:"",size:"mini","header-cell-style":{background:"#409EFF",color:"#ffffff"}}},[l("el-table-column",{attrs:{prop:"filePrefix",label:"名称"},scopedSlots:e._u([{key:"default",fn:function(a){return[l("div",{staticClass:"color-primary",on:{click:function(t){return e.onOpen(a.row)}}},[e._v(" "+e._s(a.row.filePrefix)+" ")])]}}])}),l("el-table-column",{attrs:{prop:"folderName",label:"文件名称"}}),l("el-table-column",{attrs:{prop:"fileSuffix",label:"文件类型"}}),l("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}}),l("el-table-column",{attrs:{width:"180",fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[l("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){e.onCopy(`${a.row.filePath}?token=${e.$getToken()}`)}}},[e._v("复制链接")])]}}])})],1),l("div",{staticClass:"block"},[l("el-pagination",{attrs:{size:"small","current-page":Number(e.tableData.current),"page-sizes":[10,50,100],"page-size":Number(e.tableData.size),layout:"total, sizes, prev, pager, next, jumper",total:Number(e.tableData.total)},on:{"size-change":e.handleSizeChange,"current-change":e.handlePageChange}})],1),l("el-dialog",{attrs:{title:"上传文件",visible:e.dialogVisible,width:"40%","before-close":e.handleClose},on:{"update:visible":function(a){e.dialogVisible=a}}},[l("div",{staticClass:"color-danger mb-20 cp"},[e._v("请先选择文件夹再上传图片 否则上传不上去！")]),l("el-form",{ref:"form",attrs:{model:e.form,size:"small","label-width":"80px"}},[l("el-form-item",{attrs:{label:"文件夹"}},[l("el-select",{staticClass:"w-100",attrs:{placeholder:"文件夹",clearable:""},model:{value:e.form.folderId,callback:function(a){e.$set(e.form,"folderId",a)},expression:"form.folderId"}},e._l(e.listDataFolder.records,function(a,t){return l("el-option",{key:t,attrs:{label:a.name,value:a.id}})}),1)],1),l("el-form-item",{attrs:{label:"图片"}},[l("UpLoad",{attrs:{form:e.form,limit:1,message:"最多上传一张图片"},model:{value:e.form.file,callback:function(a){e.$set(e.form,"file",a)},expression:"form.file"}})],1)],1)],1),l("el-dialog",{attrs:{title:e.dialogFile.title,visible:e.dialogFileVisible,width:"40%","before-close":e.handleClose},on:{"update:visible":function(a){e.dialogFileVisible=a}}},[l("div",[e.dialogFile.folderVisible==0?l("div",{staticClass:"color-primary mb-20 cp",on:{click:function(a){return e.onCopy(e.dialogFile.pathUrl)}}},[e._v(" "+e._s(`${e.dialogFile.pathUrl}`)+" ")]):e._e(),e.dialogFile.folderVisible==1?l("div",{staticClass:"color-primary mb-20 cp",on:{click:function(a){e.onCopy(`${e.dialogFile.pathUrl}?token=${e.$getToken()}`)}}},[e._v(" "+e._s(`${e.dialogFile.pathUrl}?token=${e.$getToken()}`)+" ")]):e._e()]),l("OpenImages",{attrs:{classStyle:"height: 500px;",url:e.dialogFile.folderVisible==0?e.dialogFile.pathUrl:`${e.dialogFile.pathUrl}?token=${e.$getToken()}`}})],1)],1)},f=[],d=r(n,c,f,!1,null,"ff5025e5",null,null);const u=d.exports;export{u as default};
